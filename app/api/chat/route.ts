import { NextRequest } from "next/server";
import OpenAI from "openai";

const client = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

// ============================================
// ğŸ¯ íƒ­ë³„ ì„¤ëª… ìŠ¤í¬ë¦½íŠ¸ (REPEAT ëª¨ë“œìš©)
// ============================================
const TAB_SCRIPTS: Record<string, string> = {
  tab1: `ì•ˆë…•í•˜ì„¸ìš”! ì—°êµ¬ë¶„ì•¼ì— ëŒ€í•´ ì„¤ëª…ë“œë¦´ê²Œìš”. 
ìš°ë¦¬ ê²½ì˜í•™ì „ê³µì€ ê²½ì˜ê¸°íš, ë§ˆì¼€íŒ…, íšŒê³„ì¬ë¬´ ì„¸ ê°€ì§€ í•µì‹¬ ë¶„ì•¼ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤. 
ê²½ì˜ê¸°íšì—ì„œëŠ” ESG í‰ê°€ì§€í‘œ ê°œë°œê³¼ ê¸°ì—…ì§€ë°°êµ¬ì¡°ë¥¼, 
ë§ˆì¼€íŒ…ì—ì„œëŠ” AI ì„œë¹„ìŠ¤ ë¡œë´‡ ìˆ˜ìš©ë„ì™€ MZì„¸ëŒ€ SNS ì „ëµì„, 
íšŒê³„ì¬ë¬´ì—ì„œëŠ” ì œì•½ë°”ì´ì˜¤ R&D íšŒê³„ì²˜ë¦¬ì™€ ê³µì‹œì •ë³´ ì‹ ë¢°ì„±ì„ ì—°êµ¬í•©ë‹ˆë‹¤.`,

  tab2: `í†µí•©êµìœ¡ì´ ì™œ ì¤‘ìš”í•œì§€ ì„¤ëª…ë“œë¦´ê²Œìš”. 
ê¸°ì—… ê²½ì˜ì€ í¼ì¦ê³¼ ê°™ì•„ì„œ, í•œ ì¡°ê°ë§Œìœ¼ë¡œëŠ” ì „ì²´ ê·¸ë¦¼ì„ ë³¼ ìˆ˜ ì—†ì–´ìš”. 
ì¬ë¬´ ì „ë¬¸ê°€ë„ ë§ˆì¼€íŒ… ROIë¥¼ ë¶„ì„í•´ì•¼ í•˜ê³ , 
íšŒê³„ì‚¬ë„ ì¸ê±´ë¹„ êµ¬ì¡°ë¥¼ ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤. 
ì‹¤ì œ ê¸°ì—…ì—ì„œëŠ” ì¬ë¬´íŒ€ê³¼ ë§ˆì¼€íŒ…íŒ€ì´ í•¨ê»˜ ì¼í•˜ê±°ë“ ìš”!`,

  tab3: `ì·¨ì—… ì „ë§ì— ëŒ€í•´ ë§ì”€ë“œë¦´ê²Œìš”. 
ìš°ë¦¬ ì „ê³µ ì·¨ì—…ë¥ ì€ 88.7%ë¡œ ì „êµ­ í‰ê·  ëŒ€ë¹„ ìš°ìˆ˜í•©ë‹ˆë‹¤. 
ê²½ì˜ê¸°íš ì§ë¬´ê°€ 48.9%ë¡œ ê°€ì¥ ë§ê³ , 
íšŒê³„ì„¸ë¬´ê¸ˆìœµì´ 20.8%, ë§ˆì¼€íŒ…ì´ 14%ë¥¼ ì°¨ì§€í•´ìš”. 
ê²½ì˜í•™ ë‹¨ì¼ì „ê³µë§Œìœ¼ë¡œë„ ì¶©ë¶„íˆ ë‹¤ì–‘í•œ ì‚°ì—…ì— ì§„ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!`,

  tab4: `ì„¸ë¶€ì „ê³µì— ëŒ€í•´ ì„¤ëª…ë“œë¦´ê²Œìš”. 
ê²½ì˜ê¸°íšì€ ê¸°ì—… ì „ëµ ìˆ˜ë¦½ê³¼ ESG ê²½ì˜ì„ ë‹¤ë£¨ê³ , 
ë§ˆì¼€íŒ…ì€ ì†Œë¹„ì í–‰ë™ ë¶„ì„ê³¼ ë””ì§€í„¸ ë§ˆì¼€íŒ…ì„, 
íšŒê³„ì¬ë¬´ëŠ” ì¬ë¬´ì œí‘œ ë¶„ì„ê³¼ ë¦¬ìŠ¤í¬ ê´€ë¦¬ë¥¼ ë°°ì›ë‹ˆë‹¤. 
íŠ¹íˆ ì°¨ì˜ê³¼í•™ëŒ€ë§Œì˜ í—¬ìŠ¤ì¼€ì–´ ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ì• ë„ë¦¬í‹±ìŠ¤ íŠ¹í™” ë¶„ì•¼ê°€ ìˆì–´ìš”!`,

  tab5: `ê²½ì˜í•™ì˜ ë¯¸ë˜ê°€ì¹˜ì— ëŒ€í•´ ë§ì”€ë“œë¦´ê²Œìš”. 
AI ì‹œëŒ€ì—ë„ ê²½ì˜í•™ì€ ì˜¤íˆë ¤ ë” ì¤‘ìš”í•´ì§‘ë‹ˆë‹¤! 
AIì™€ ë¹…ë°ì´í„°ë¥¼ ë¹„ì¦ˆë‹ˆìŠ¤ë¡œ ì „í™˜í•˜ë ¤ë©´ ê²½ì˜ ì „ë¬¸ê°€ê°€ í•„ìš”í•˜ê±°ë“ ìš”. 
ì „ëµì  ì˜ì‚¬ê²°ì •, ì´í•´ê´€ê³„ì ì¡°ì •, ìœ¤ë¦¬ì  ê²½ì˜ íŒë‹¨ì€ 
AIê°€ ëŒ€ì²´í•  ìˆ˜ ì—†ëŠ” ì˜ì—­ì…ë‹ˆë‹¤.`,

  tab6: `íŒ€í”„ë¡œì íŠ¸ì— ëŒ€í•´ ì„¤ëª…ë“œë¦´ê²Œìš”. 
ë„¤, ë§ì•„ìš”! ê²½ì˜í•™ê³¼ëŠ” íŒ€í”Œê³¼ ë°œí‘œê°€ ë§ìŠµë‹ˆë‹¤. 
ì‹¤ì œ ê¸°ì—…ì´ íŒ€ì›Œí¬ ê¸°ë°˜ì´ê¸° ë•Œë¬¸ì´ì—ìš”. 
íŒ€í”Œì„ í†µí•´ ì˜ì‚¬ì†Œí†µ ëŠ¥ë ¥, ë¬¸ì œí•´ê²° ëŠ¥ë ¥, ë¦¬ë”ì‹­ì„ ê¸°ë¥¼ ìˆ˜ ìˆê³ , 
ê¸°ì—…ê²½ì˜ì‚¬ë¡€ ê²½ì§„ëŒ€íšŒ ê°™ì€ ì‹¤ì „ ê²½í—˜ì€ ì·¨ì—… ì‹œ í° ê°•ì ì´ ë©ë‹ˆë‹¤!`,

  tab7: `ë°”ì´ì˜¤ìœµí•©ì— ëŒ€í•´ ë§ì”€ë“œë¦´ê²Œìš”. 
ë°”ì´ì˜¤ì™€ ê²½ì˜ì˜ ì¡°í•©ì€ ì •ë§ ê°•ë ¥í•©ë‹ˆë‹¤! 
ë°”ì´ì˜¤ì‚°ì—…ì€ R&D ë¹„ìš©ì´ ìˆ˜ì²œì–µ ì›ì— ë‹¬í•˜ê³  ì œí’ˆ ì¶œì‹œê¹Œì§€ 10ë…„ ì´ìƒ ê±¸ë ¤ìš”. 
ê·¸ë˜ì„œ ì „ëµì  í¬íŠ¸í´ë¦¬ì˜¤ ê´€ë¦¬ì™€ íŒŒì´ë‚¸ì‹±ì´ í•„ìˆ˜ì…ë‹ˆë‹¤. 
ì‹¤ì œë¡œ ì¡¸ì—…ìƒì˜ 24.9%ê°€ ë°”ì´ì˜¤í—¬ìŠ¤ì¼€ì–´ ë¶„ì•¼ë¡œ ì§„ì¶œí•˜ê³  ìˆì–´ìš”!`,

  tab8: `ì°¨ì˜ê³¼í•™ëŒ€ë§Œì˜ ê°•ì ì„ ì„¤ëª…ë“œë¦´ê²Œìš”. 
ìš°ë¦¬ëŠ” ë°”ì´ì˜¤í—¬ìŠ¤ì¼€ì–´ íŠ¹í™” ê²½ì˜í•™ì…ë‹ˆë‹¤! 
ì°¨ë³‘ì› ë„¤íŠ¸ì›Œí¬ì™€ ì—°ê³„ë˜ì–´ ì¡¸ì—…ìƒì˜ 10.9%ê°€ ì°¨ë³‘ì›ê·¸ë£¹ì— ì·¨ì—…í•˜ê³ , 
ì˜ë£Œê²½ì˜, ë°”ì´ì˜¤ì‚°ì—…ë¡  ê°™ì€ íŠ¹í™” ì»¤ë¦¬í˜ëŸ¼ì´ ìˆì–´ìš”. 
í•œêµ­ì¡°ì„¸ì¬ì •ì—°êµ¬ì›, ê¸ˆìœµê°ë…ì› ë“±ê³¼ì˜ ì—°êµ¬ ë„¤íŠ¸ì›Œí¬ë„ ê°•ì ì…ë‹ˆë‹¤.`,

  tab9: `ì¡¸ì—…ìƒ ì§„ë¡œì— ëŒ€í•´ ë§ì”€ë“œë¦´ê²Œìš”. 
ì·¨ì—…ë¥  88.7%ì— ì°½ì—… 5.4%, ëŒ€í•™ì› ì§„í•™ 5.9%ì…ë‹ˆë‹¤. 
ì‚°ì—…ë³„ë¡œëŠ” ë°”ì´ì˜¤í—¬ìŠ¤ì¼€ì–´ 24.9%, ê¸ˆìœµ 19.5%, IT 19%ì´ê³ , 
í•˜ë‚˜ì€í–‰, ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤, ì¿ íŒ¡, ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë“± 
ë‹¤ì–‘í•œ ë¶„ì•¼ì˜ ê¸°ì—…ì— ì·¨ì—…í•˜ê³  ìˆì–´ìš”!`,

  tab10: `ì˜ˆìˆ ê²½ì˜ì— ëŒ€í•´ ì„¤ëª…ë“œë¦´ê²Œìš”. 
ì˜ˆìˆ ê³¼ ê²½ì˜ì€ ì™„ë²½í•œ ì¡°í•©ì…ë‹ˆë‹¤! 
ê³µì—°ê¸°íšì, ë¯¸ìˆ ê´€ íë ˆì´í„°, ë¬¸í™”ë§ˆì¼€í„°ë¡œ ì§„ì¶œí•  ìˆ˜ ìˆì–´ìš”. 
ì‹¤ì œë¡œ FNCì—”í„°í…Œì¸ë¨¼íŠ¸, ì„œìš¸í™˜ê²½ì˜í™”ì œ ë“±ì— ì·¨ì—…í•œ ì„ ë°°ë“¤ì´ ìˆìŠµë‹ˆë‹¤. 
ì˜ˆìˆ ë„ ê´€ê°ì´ ìˆì–´ì•¼ í•˜ê³ , ìˆ˜ìµëª¨ë¸ ì„¤ê³„ê°€ í•„ìˆ˜ë‹ˆê¹Œìš”!`,

  tab11: `ë””ì§€í„¸ë³´ê±´ì˜ë£Œì™€ AIì˜ë£Œë°ì´í„°ì˜ ì°¨ì´ë¥¼ ì„¤ëª…ë“œë¦´ê²Œìš”. 
ë””ì§€í„¸ë³´ê±´ì˜ë£ŒëŠ” ì„œë¹„ìŠ¤ ê¸°íš ì¤‘ì‹¬ìœ¼ë¡œ ì‚¬ëŒê³¼ì˜ ì†Œí†µì´ ì¤‘ìš”í•˜ê³ , 
ë³‘ì› ê²½ì˜ê¸°íšì´ë‚˜ ë””ì§€í„¸ í—¬ìŠ¤ ì„œë¹„ìŠ¤ ê¸°íš ìª½ìœ¼ë¡œ ê°‘ë‹ˆë‹¤. 
AIì˜ë£Œë°ì´í„°ëŠ” ë°ì´í„° ë¶„ì„ ì¤‘ì‹¬ìœ¼ë¡œ 
í—¬ìŠ¤ì¼€ì–´ ë°ì´í„° ë¶„ì„ê°€ë‚˜ ë³´í—˜ ë¦¬ìŠ¤í¬ ë¶„ì„ ìª½ìœ¼ë¡œ ì§„ì¶œí•´ìš”. 
ë‘˜ ë‹¤ ê²½ì˜í•™ê³¼ ì‹œë„ˆì§€ê°€ í½ë‹ˆë‹¤!`,

  tab12: `ë¯¸ë””ì–´ìœµí•©ì— ëŒ€í•´ ë§ì”€ë“œë¦´ê²Œìš”. 
ë¯¸ë””ì–´ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ê³¼ ê²½ì˜í•™ì€ ì™„ë²½í•œ ì¡°í•©ì…ë‹ˆë‹¤! 
ìš”ì¦˜ ëª¨ë“  ê¸°ì—…ì´ ë¯¸ë””ì–´ ê¸°ì—…ì´ì—ìš”. ìœ íŠœë¸Œ, ì¸ìŠ¤íƒ€ ì±„ë„ì„ ì§ì ‘ ìš´ì˜í•˜ë‹ˆê¹Œìš”. 
IR, PR, ì½˜í…ì¸  ë¹„ì¦ˆë‹ˆìŠ¤, ì¸í”Œë£¨ì–¸ì„œ ë§ˆì¼€íŒ… ë¶„ì•¼ë¡œ ì§„ì¶œí•  ìˆ˜ ìˆê³ , 
ê´‘ê³ ëŒ€í–‰ì‚¬, ë°©ì†¡ì‚¬, MCN ê¸°ì—…ì— ì·¨ì—…í•œ ì„ ë°°ë“¤ì´ ë§ìŠµë‹ˆë‹¤!`,

  tab13: `ìˆ˜í•™ì´ ê±±ì •ë˜ì‹œëŠ” ë¶„ë“¤ê»˜ ë§ì”€ë“œë¦´ê²Œìš”. 
ê±±ì • ë§ˆì„¸ìš”! ê¸°ì´ˆë¶€í„° ì°¨ê·¼ì°¨ê·¼ ê°€ë¥´ì¹©ë‹ˆë‹¤. 
íšŒê³„ì›ë¦¬ëŠ” ìì‚° = ë¶€ì±„ + ìë³¸ë¶€í„°, 
ê²½ì˜í†µê³„ëŠ” í‰ê· , ë¶„ì‚°ë¶€í„° ì‹œì‘í•´ìš”. 
ê³ ë“±í•™êµ ìˆ˜í•™ ìˆ˜ì¤€ì´ë©´ ì¶©ë¶„í•˜ê³ , 
êµìˆ˜í•™ìŠµì§€ì›ì„¼í„° íŠœí„°ë§ê³¼ ì„ ë°° ë©˜í† ë§ë„ ìˆìŠµë‹ˆë‹¤!`,

  tab14: `ì˜ìƒê´‘ê³ ì™€ ê²½ì˜ì˜ ì—°ê²°ì— ëŒ€í•´ ì„¤ëª…ë“œë¦´ê²Œìš”. 
ì˜ìƒ ì œì‘ ëŠ¥ë ¥ì— ê²½ì˜ ì „ëµì„ ë”í•˜ë©´ ìµœê°• ì½˜í…ì¸  í¬ë¦¬ì—ì´í„°ê°€ ë©ë‹ˆë‹¤! 
ë§ˆì¼€íŒ… í”„ë ˆì„ì›Œí¬ë¡œ ì˜ìƒì„ ê¸°íší•˜ê³ , 
A/B í…ŒìŠ¤íŠ¸ë¡œ ìµœì í™”í•˜ê³ , ROIë¥¼ ì¸¡ì •í•  ìˆ˜ ìˆì–´ìš”. 
ë‹¨ìˆœíˆ ì˜ˆìœ ì˜ìƒì´ ì•„ë‹ˆë¼, ëª©í‘œë¥¼ ë‹¬ì„±í•˜ëŠ” ì½˜í…ì¸ ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!`,
};

const SYSTEM_PROMPT = `ë‹¹ì‹ ì€ ì°¨ì˜ê³¼í•™ëŒ€í•™êµ ë¯¸ë˜ìœµí•©ëŒ€í•™ í—¬ìŠ¤ì¼€ì–´ìœµí•©í•™ë¶€ ê²½ì˜í•™ì „ê³µì˜ AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤.
í•™ìƒë“¤ì˜ ì „ê³µ ê´€ë ¨ ì§ˆë¬¸ì— ì¹œì ˆí•˜ê³  ì •í™•í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”.
ë‹µë³€ì€ ê°„ê²°í•˜ê²Œ 2-3ë¬¸ì¥ìœ¼ë¡œ í•´ì£¼ì„¸ìš”. ë„ˆë¬´ ê¸¸ê²Œ ë‹µë³€í•˜ì§€ ë§ˆì„¸ìš”.

## ê²½ì˜í•™ì „ê³µ ì§€ì‹

### ì—°êµ¬ë¶„ì•¼
ê²½ì˜í•™ì „ê³µì—ì„œëŠ” ê²½ì˜ê¸°íš, ë§ˆì¼€íŒ…, íšŒê³„ì¬ë¬´ì˜ í•µì‹¬ ì´ë¡ ì„ ë‹¤ë£¹ë‹ˆë‹¤.
- ê²½ì˜ê¸°íš: ê¸°ì—…ì „ëµ, ì¡°ì§ê´€ë¦¬, ESG í‰ê°€ì§€í‘œ ê°œë°œ, ê¸°ì—…ì§€ë°°êµ¬ì¡° ê°œì„ 
- ë§ˆì¼€íŒ…: ì†Œë¹„ì í–‰ë™, ë¸Œëœë“œ ì „ëµ, ì„œë¹„ìŠ¤ ë§ˆì¼€íŒ…, AI ì„œë¹„ìŠ¤ ë¡œë´‡ ìˆ˜ìš©ë„, MZì„¸ëŒ€ SNS ì „ëµ
- íšŒê³„ì¬ë¬´: ê¸°ì—…ê°€ì¹˜ í‰ê°€, íšŒê³„íˆ¬ëª…ì„±, íˆ¬ìì˜ì‚¬ê²°ì •, ì œì•½ë°”ì´ì˜¤ R&D íšŒê³„ì²˜ë¦¬

### êµìˆ˜ì§„ ì—°êµ¬ ì„±ê³¼
- êµ­ì œ ì €ë„: Psychology and Marketing, Applied Economics Letters, Journal of Forecasting, International Journal of Hospitality Management
- êµ­ë‚´ ì €ë„: íšŒê³„í•™ì—°êµ¬, ê²½ì˜í•™ì—°êµ¬, í•œêµ­ì–¸ë¡ í•™ë³´, í•œêµ­ë°©ì†¡í•™ë³´
- ì—°êµ¬ ì£¼ì œ: ESG ë‰´ìŠ¤ì˜ ê¸°ì—…ê°€ì¹˜ ì˜í–¥, Kì½˜í…ì¸  ê¸€ë¡œë²Œ ì „ëµ, AIìœµí•©ì—°êµ¬ë°©ë²•ë¡ , AI ì§€ëŠ¥í˜• ë´‡ ê°œë°œ

### ì·¨ì—…ë¥  ë° ì§„ë¡œ
- ì·¨ì—…ë¥ : 88.7% (ì „êµ­ í‰ê·  ëŒ€ë¹„ ìš°ìˆ˜)
- ì§ë¬´ë³„: ê²½ì˜ê¸°íš 48.9%, íšŒê³„ì„¸ë¬´ê¸ˆìœµ 20.8%, ë§ˆì¼€íŒ… 14.0%
- ì‚°ì—…ë³„: ë°”ì´ì˜¤í—¬ìŠ¤ì¼€ì–´ 24.9%, ê¸ˆìœµ 19.5%, IT 19.0%, ì°¨ë³‘ì›ê·¸ë£¹ 10.9%

### ì£¼ìš” ì·¨ì—…ì²˜
- ê¸ˆìœµ: í•˜ë‚˜ì€í–‰, SKì¦ê¶Œ, ì‹ í•œì€í–‰, KBêµ­ë¯¼ì€í–‰
- ëŒ€ê¸°ì—…: í˜„ëŒ€ìë™ì°¨, ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤, ë¡¯ë°, CJì˜¬ë¦¬ë¸Œì˜
- IT: ì¿ íŒ¡, ìŠ¤ë§ˆì¼ê²Œì´íŠ¸, ë©”ê°€ì¡´í´ë¼ìš°ë“œ
- ë³‘ì›: ì„¸ë¸Œë€ìŠ¤ë³‘ì›, ì°¨ë³‘ì› ê³„ì—´

### ì°¨ì˜ê³¼í•™ëŒ€ íŠ¹í™” ë¶„ì•¼
- í—¬ìŠ¤ì¼€ì–´ ë¹„ì¦ˆë‹ˆìŠ¤: ì˜ë£Œì„œë¹„ìŠ¤ ê²½ì˜, ì˜ë£Œê´€ê´‘, ë°”ì´ì˜¤ì‚°ì—… ë¶„ì„
- ë¹„ì¦ˆë‹ˆìŠ¤ ì• ë„ë¦¬í‹±ìŠ¤: ê²½ì˜ë¹…ë°ì´í„° ë¶„ì„, ê±´ê°•ë³´í—˜ê³µë‹¨ ë°ì´í„° í™œìš©, AI ê¸°ë°˜ ì˜ì‚¬ê²°ì •
- ì°¨ë³‘ì› ë„¤íŠ¸ì›Œí¬: ì¡¸ì—…ìƒ 10.9%ê°€ ì°¨ë³‘ì›ê·¸ë£¹ ì·¨ì—…

### ì„¸ë¶€ì „ê³µ
- ê²½ì˜ê¸°íš: ê¸°ì—… ì „ëµ ìˆ˜ë¦½, ì¡°ì§ ì„¤ê³„, ESG ê²½ì˜ â†’ ì „ëµê¸°íš, ê²½ì˜ì»¨ì„¤íŒ… ì§„ì¶œ
- ë§ˆì¼€íŒ…: ì†Œë¹„ì í–‰ë™ ë¶„ì„, ë¸Œëœë“œ ê´€ë¦¬, ë””ì§€í„¸ ë§ˆì¼€íŒ… â†’ ë§ˆì¼€íŒ…ë§¤ë‹ˆì €, ë¸Œëœë“œë§¤ë‹ˆì € ì§„ì¶œ
- íšŒê³„ì¬ë¬´: ì¬ë¬´ì œí‘œ ë¶„ì„, íˆ¬ì ì˜ì‚¬ê²°ì •, ë¦¬ìŠ¤í¬ ê´€ë¦¬ â†’ íšŒê³„ì‚¬, ì• ë„ë¦¬ìŠ¤íŠ¸, í€ë“œë§¤ë‹ˆì € ì§„ì¶œ

### ìœµí•© ì „ê³µ
- ë””ì§€í„¸ë³´ê±´ì˜ë£Œ + ê²½ì˜: ë³‘ì› ê²½ì˜ê¸°íš, ë””ì§€í„¸ í—¬ìŠ¤ ì„œë¹„ìŠ¤ ê¸°íš, ì˜ë£Œê¸°ê¸° ë§ˆì¼€íŒ…
- AIì˜ë£Œë°ì´í„° + ê²½ì˜: í—¬ìŠ¤ì¼€ì–´ ë°ì´í„° ë¶„ì„ê°€, ë³´í—˜ ë¦¬ìŠ¤í¬ ë¶„ì„, AI ì„œë¹„ìŠ¤ ê¸°íš
- ë¯¸ë””ì–´ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ + ê²½ì˜: IR, PR, ì½˜í…ì¸  ë¹„ì¦ˆë‹ˆìŠ¤, ë¸Œëœë“œ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜

### íŒ€í”„ë¡œì íŠ¸
íŒ€í”„ë¡œì íŠ¸ê°€ ë§ì€ ì´ìœ : ì‹¤ì œ ê¸°ì—…ì´ íŒ€ì›Œí¬ë¡œ ìš´ì˜ë˜ê³ , í¬ë¡œìŠ¤í‘ì…˜ í˜‘ì—…ì´ í•„ìˆ˜ì ì´ê¸° ë•Œë¬¸
ê°œë°œ ì—­ëŸ‰: ì˜ì‚¬ì†Œí†µ ëŠ¥ë ¥, ë¬¸ì œí•´ê²° ëŠ¥ë ¥, ë¦¬ë”ì‹­, í”„ë ˆì  í…Œì´ì…˜ ìŠ¤í‚¬

### ìˆ˜í•™/íšŒê³„ ê¸°ì´ˆ
ìˆ˜í•™ì„ ëª¨ë¥´ëŠ” í•™ìƒë„ ê¸°ì´ˆë¶€í„° ë°°ìš¸ ìˆ˜ ìˆìŒ. ê³ ë“±í•™êµ ìˆ˜ì¤€ì˜ ìˆ˜í•™ì´ë©´ ì¶©ë¶„.
í•™ìŠµ ì§€ì›: êµìˆ˜í•™ìŠµì§€ì›ì„¼í„° íŠœí„°ë§, ì„ ë°° ë©˜í† ë§, SPSS/R ìˆ˜ì—… ë‚´ êµìœ¡

### ë¬¸í™”ì˜ˆìˆ ê²½ì˜
ì˜ˆìˆ ì— ê´€ì‹¬ ìˆëŠ” í•™ìƒ: ê³µì—°ê¸°íšì, ë¯¸ìˆ ê´€ íë ˆì´í„°, ë¬¸í™”ë§ˆì¼€í„°, ì—”í„°í…Œì¸ë¨¼íŠ¸ ê²½ì˜
ì¡¸ì—…ìƒ ì§„ì¶œ: FNCì—”í„°í…Œì¸ë¨¼íŠ¸, ì„œìš¸í™˜ê²½ì˜í™”ì œ, ê´‘ê³ ëŒ€í–‰ì‚¬, ë°©ì†¡ì‚¬
`;

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { type, tabId, message, history } = body;

    // ============================================
    // ğŸ¯ íƒ­ ì„¤ëª… ìš”ì²­ ì²˜ë¦¬ (OpenAI í˜¸ì¶œ ì—†ì´ ê³ ì • ìŠ¤í¬ë¦½íŠ¸ ë°˜í™˜)
    // ============================================
    if (type === "tab_explain") {
      const script = TAB_SCRIPTS[tabId];
      
      if (script) {
        console.log(`ğŸ“‘ Tab explain request: ${tabId}`);
        return new Response(JSON.stringify({ reply: script }), {
          status: 200,
          headers: { "Content-Type": "application/json" },
        });
      } else {
        return new Response(JSON.stringify({ reply: "í•´ë‹¹ íƒ­ì— ëŒ€í•œ ì„¤ëª…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." }), {
          status: 200,
          headers: { "Content-Type": "application/json" },
        });
      }
    }

    // ============================================
    // ğŸ’¬ ì¼ë°˜ ì±„íŒ… ìš”ì²­ ì²˜ë¦¬ (OpenAI API ì‚¬ìš©)
    // ============================================
    if (!process.env.OPENAI_API_KEY) {
      throw new Error("OpenAI API key is missing");
    }

    const messages: OpenAI.ChatCompletionMessageParam[] = [
      { role: "system", content: SYSTEM_PROMPT },
      ...(history || []).map((msg: { role: string; content: string }) => ({
        role: msg.role as "user" | "assistant",
        content: msg.content,
      })),
      { role: "user", content: message },
    ];

    const response = await client.chat.completions.create({
      model: "gpt-4o-mini",
      messages,
      max_tokens: 300,
      temperature: 0,
    });

    const reply = response.choices[0]?.message?.content || "ì£„ì†¡í•©ë‹ˆë‹¤. ë‹µë³€ì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";

    return new Response(JSON.stringify({ reply }), {
      status: 200,
      headers: { "Content-Type": "application/json" },
    });
  } catch (error) {
    console.error("API error:", error);
    return new Response(JSON.stringify({ error: "Failed to get response" }), {
      status: 500,
      headers: { "Content-Type": "application/json" },
    });
  }
}
